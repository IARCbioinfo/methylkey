---
title: "Minfi"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
params:
  project: "methylkey4"
---

```{r include = FALSE}
  library(knitr)
  library(formattable)
  library(data.table)
```

# pdata

[ Sample Sheet ](`r params$project`/pdata.txt)

```{r echo=FALSE, results ='asis'}
pdata<-fread(paste0(params$project,"/pdata.txt"))
kable(pdata)

```

# betas

[ Betas Normalized ](`r params$project`/betas.txt)

```{r echo=FALSE, results ='asis', warning=FALSE}
betas<-fread(paste0(params$project,"/betas.txt"),nrows=100)
kable(betas)

```

# delta betas

[ Delta Betas ](`r params$project`/deltabetas.txt)

```{r echo=FALSE, results ='asis', warning=FALSE}
deltabetas<-fread(paste0(params$project,"/deltabetas.txt"),nrows=100)
kable(deltabetas)

```

# Minfi QC

## 1

### [ log2 intensity of both methylated and unmethylated probes ](`r params$project`/boxplot_colour1.jpg)

```{r}
  knitr::include_graphics(paste0(params$project,"/boxplot_colour1.jpg"))
```
	
### [ Red Channel ](`r params$project`/plotQC.jpg)

```{r}
  knitr::include_graphics(paste0(params$project,"/unmethylated1.jpg"))

```
	
## 2	
	
### [ QC ](`r params$project`/plotQC.jpg)
	
```{r}
	knitr::include_graphics(paste0(params$project,"/plotQC.jpg"))
	
```	

### [ Green Channel ](`r params$project`/plotQC.jpg)

```{r, results='asis'}
	  knitr::include_graphics(paste0(params$project,"/methylated1.jpg"))

```


# Groups


## Groups {.tabset .tabset-fade .tabset-pills}

```{r, results='asis'}
  groups<-list.files( params$project, "densityBeanPlot1.jpg", recursive=T )
  groups<-gsub("densityBeanPlot1.jpg","",groups)
	for (group in groups) {
	  
	  cat("###", group, "\n\n")
	  dir<-paste0(params$project, "/", group)
	  
	  cat("\n\n| before normalization | After normalization|\n|-|-|\n")
	  
	  cat("|![](", dir, "/densityPlot1.jpg)","|", sep = "")
	  cat("![](", dir, "/densityPlot2.jpg)","|\n", sep = "")
	  
	  cat("|![](", dir, "/densityBeanPlot1.jpg)","|", sep = "")
	  cat("![](", dir, "/densityBeanPlot2.jpg)","|\n", sep = "")
	  
	  cat("|![](", dir, "/mdsPlot1.jpg)","|", sep = "")
	  cat("![](", dir, "/mdsPlot2.jpg)","|\n", sep = "")
	  
	  cat('\n\n')
	  
	}
	
	
```


# PCA 

## 1 {.tabset .tabset-fade .tabset-pills}

### Contributions

[ ![](`r params$project`/pca_contributions_0001.jpg) ](`r params$project`/pca_contributions_0001.jpg)

### [ pvalues ](`r params$project`/pvalue_0001.txt)

```{r, results='asis'}
    pvalue<-fread(paste0(params$project,"/pvalue_0001.txt"), header=F)
    sig_pvalue_bold <- formatter("span", style = x ~ style("background-color" = ifelse(x <= 1e-5, "pink", ifelse(x <= 0.05, "palegoldenrod", "transparent"))))
    formattable(pvalue, list(area(col = names(pvalue)[-1]) ~ sig_pvalue_bold ))
    
```

### [ qvalues ](`r params$project`/qvalue_0001.txt)

```{r, results='asis'}
    qvalue<-fread(paste0(params$project,"/qvalue_0001.txt"), header=F)
    sig_qvalue_bold <- formatter("span", style = x ~ style("background-color" = ifelse(x <= 0.05, "pink", ifelse(x <= 0.1, "palegoldenrod", "transparent"))))
    formattable(qvalue, list(area(col = names(pvalue)[-1]) ~ sig_pvalue_bold ))
    
```