<?xml version="1.0"?>
<tool id="cometplot" name="Comet Plot" version="0.1.2">
<description>plot DMPs with coMET</description>

<requirements>
    <requirement type="package" version="2.0" >r-methylkey</requirement>
</requirements>

<command>
	#import re
	#set inputDir=$re.sub("\.dat","_files",str($input))

	cp $__tool_directory__/../bin/methylkey_comet.Rmd index.Rmd;

	mkdir $html.files_path;

	Rscript -e "rmarkdown::render('index.Rmd', params=list( 

	path='$__tool_directory__/../bin' ,
	meth='$inputDir/report/meth.rdata' ,
	win=$win ,
	max=$max ,
	dmps='$dmps' ,
	out='report'))";
	
	mv report $html.files_path/.;
</command>

<inputs>
	<param name="input" type="data" format="html" label="DMPs report" />
	<param name="win" type="text" value="10000" label="Windows size" />
	<param name="max" type="text" value="10" label="Max dmps to plot" />
	<param name="dmps" type="text" value="" label="dmp to plot" /> 
</inputs>

<outputs>
	<data name="html" format="html" label="coMET on ${on_string}" from_work_dir="index.html"/>
</outputs>

<stdio>

<regex match="Warning message:"
           source="both"
           level="warning"
           description="Warning message:" />
<regex match="error"
           source="both"
           level="fatal"
           description="error encountered" />
</stdio>


<help>

</help>

</tool>
